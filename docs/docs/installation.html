<h1>📦 安裝與配置</h1>
<p>
  <code>pg-trigger-manager</code>
  旨在提供「零設定」的開發體驗。您只需要配置資料庫連線，系統會自動處理其餘細節。
</p>

<h2>0. 前置需求</h2>
<ul>
  <li>Node.js 18+（建議 LTS）</li>
  <li>PostgreSQL 13+（需可建立 Trigger / Function）</li>
  <li>可連線到資料庫的帳號（開發環境通常為 superuser）</li>
</ul>

<h2>1. 環境變數設定</h2>
<p>建立 <code>.env</code> 檔案並填入以下資訊：</p>
<pre><code># PostgreSQL 連線
POSTGRES_HOST=localhost
POSTGRES_DB=your_db
POSTGRES_USER=your_user
POSTGRES_PASSWORD=your_pass

# 🚀 宣告式監聽配置 (優雅模式)
# 列出您想要自動掛載觸發器的資料表，以逗號分隔。
WATCH_TABLES=users,posts,orders

# 選用：伺服器連接埠
PORT=5000
</code></pre>

<p>
  <strong>注意：</strong>若資料表位於非 <code>public</code> schema，請先確認該
  schema 權限與觸發器建立權限。
</p>

<h2>2. 自動初始化流程</h2>
<p>當您執行 <code>npm start</code> 時，系統會自動執行以下動作：</p>
<ul>
  <li>
    <strong>自動檢查函式</strong>：在資料庫中建立
    <code>notify_trigger()</code> 通用函式。
  </li>
  <li>
    <strong>自動掛載觸發器</strong>：為
    <code>WATCH_TABLES</code> 中的每一張表建立
    <code>AFTER INSERT/UPDATE/DELETE</code> 觸發器。
  </li>
  <li>
    <strong>建立稽核日誌</strong>：自動建立
    <code>audit_log</code> 表以支援斷線重連。
  </li>
</ul>

<h2>3. 建議的最小資料表</h2>
<p>若您要快速驗證全流程，可先建立一張簡單表：</p>
<pre><code>CREATE TABLE IF NOT EXISTS users (
  id BIGSERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  status TEXT DEFAULT 'active',
  created_at TIMESTAMPTZ DEFAULT now()
);
</code></pre>

<h2>4. 啟動伺服器</h2>
<pre><code>npm install
npm start
</code></pre>
<p>伺服器預設啟動於 <code>http://localhost:5000</code>。</p>

<h2>5. 快速驗證（可選）</h2>
<ol>
  <li>啟動伺服器後，前端以 SDK 訂閱 <code>users</code>。</li>
  <li>在資料庫執行 <code>INSERT INTO users(name) VALUES ('ray');</code>。</li>
  <li>確認前端收到 <code>action=insert</code> 事件與更新後列表。</li>
</ol>

<h2>6. 常見問題排查</h2>
<ul>
  <li>
    <strong>收不到事件：</strong>先確認目標表是否包含在
    <code>WATCH_TABLES</code>。
  </li>
  <li>
    <strong>RLS 查不到資料：</strong>確認是否已呼叫
    <code>sdk.auth(userId)</code> 且資料庫 policy 正確。
  </li>
  <li>
    <strong>WebSocket 連不上：</strong>檢查後端 URL、反向代理與 ws/wss 設定。
  </li>
</ul>

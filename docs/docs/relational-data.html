<h1>💎 關聯資料查詢 (Relational DSL)</h1>

<p>Node-PG-Trigger 支援強大的關聯語意 DSL，讓您可以如同使用嵌套物件般，輕鬆抓取 PostgreSQL 中的關聯資料（Joins），且支援實時更新。</p>

<h2>🚀 使用 include() 語法</h2>

<p>透過 <code>include()</code>，您可以定義要展開的關聯表、關聯欄位以及類型。</p>

<pre><code class="language-typescript">
// 範例：獲取貼文並自動展開作者資訊 (1:1)
const posts = sdk.collection('posts')
  .include('author', {
    targetTable: 'users',
    localField: 'author_id',
    targetField: 'id',
    type: '1:1',
    select: ['name', 'avatar'] // 可選：僅選取特定欄位
  });

posts.onSnapshot(({ record: list }) => {
  list.forEach(post => {
    console.log(`${post.title} by ${post.author.name}`);
  });
});
</code></pre>

<h2>📦 支援的關聯類型</h2>

<ul>
  <li><strong>1:1 (Has One / Belongs To)</strong>: 獲取單一關聯對象。例如貼文的作者、使用者的設定檔。</li>
  <li><strong>1:N (Has Many)</strong>: 獲取關聯列表。例如使用者的貼文列表、產品的評論。</li>
</ul>

<pre><code class="language-typescript">
// 範例：獲取產品並展開其評論 (1:N)
const products = sdk.collection('products')
  .include('comments', {
    targetTable: 'comments',
    localField: 'id',
    targetField: 'product_id',
    type: '1:N'
  });

const list = await products.get();
// list[0].comments 將會是一個陣列
</code></pre>

<h2>⚡ 效能與即時性</h2>

<ul>
  <li><strong>Server-side Joins</strong>: 關聯展開是在伺服器端透過高效的 SQL <code>LATERAL JOIN</code> 處理，客戶端僅需一次網路往返即可獲得完整嵌套 JSON。</li>
  <li><strong>Realtime Chain</strong>: 當關聯表（如作者名稱）更新時，主表的訂閱會自動重新計算並推送最新快照（需搭配後端 Cascade Trigger）。</li>
</ul>

<div class="info-box">
  <strong>提示：</strong> 您可以鏈式呼叫多個 <code>include()</code> 來展開不同的關聯欄位。
</div>

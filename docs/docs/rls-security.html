<h1>🔒 身分驗證與 RLS (Auth & Security)</h1>

<p>安全是實時應用的重中之重。我們利用 PostgreSQL 的 Row-Level Security (RLS) 確保每個使用者只能看到他們有權存取的數據。</p>

<hr>

<h2>身分注入</h2>

<p>在前端登入後，將 User ID 或 Token 注入 SDK：</p>
<pre><code>sdk.auth('user_id_123');</code></pre>

<p>這會使後續所有的 WebSocket 訂閱與 HTTP 請求都帶上身分識別。後端會自動在資料庫 Session 中執行：</p>
<pre><code>SET LOCAL "request.user_id" = 'user_id_123';</code></pre>

<hr>

<h2>SQL 權限策略實作</h2>

<p>您只需在 SQL 中定義規則，系統會自動在推送時套用過濾：</p>

<pre><code>-- 僅允許使用者查看自己的私人筆記
CREATE POLICY note_access_policy ON private_notes
FOR SELECT
USING (owner_id = current_setting('request.user_id')::text);</code></pre>

<hr>

<h2>優點</h2>
<ul>
    <li><strong>零後端代碼過濾</strong>: 不需在 Node.js 中寫 <code>if (data.owner !== user)</code>。</li>
    <li><strong>即時生效</strong>: 當 SQL 策略更新，下一次推送立即套用新規則。</li>
    <li><strong>強制執行</strong>: 即使開發者忘記在前端加過濾條件，資料庫也會硬性攔截非法數據。</li>
</ul>

<hr>

<h2>🎓 接下來</h2>
<p>前往 <a href="#/docs/rls-best-practices">RLS 最佳實踐</a> 深入了解各種業務場景的策略定義。</p>
